.topics{"data-controller" => "topics"}
  .page-header-row.mobile-header
    .builder-logo-container
      - if @socratic_seminar.organization.name.include?("uilder")
        = image_tag 'builder-logo.png', alt: 'Builder Voting Logo'
      - else
        = image_tag 'lightning-bitcoin-logo-2.png', alt: 'Lightning Voting Logo'
    .mobile-header-content
      %h1.page-header-title
        = @socratic_seminar.organization.name + " ##{@socratic_seminar.seminar_number}"
      .toggles-container
        .sats-btc-toggle
          = render 'topics/mobile/sats_btc_toggle'
        .lightning-effects-toggle
          = render 'topics/mobile/lightning_effects_toggle'
  - has_votable_topics = @topics.any?(&:votable)
  - has_payable_topics = @topics.any?(&:payable)

  - if has_votable_topics || has_payable_topics
    .voting-instructions.mobile-instructions
      %ul
        - if has_votable_topics
          %li Vote for free with the Up & Down arrows
        - if has_payable_topics && !has_votable_topics
          %li Send Lightning payments to show appreciation
        - if has_votable_topics && has_payable_topics
          %li Votes count for ranking. Lightning payments add votes, but don't count for ranking

  - @sections.each do |section|
    %h2.section-title= section.name
    %ul
      - @topics.select { |topic| topic.section_id == section.id }.each do |topic|
        - vote_state = (@vote_states && @vote_states[topic.id.to_s])
        %li.topic-list-item{"data-topic-id" => topic.id, "data-votes" => topic.votes || 0}
          .topic-header-row
            %span.topic-name
              = link_to topic.name, socratic_seminar_topic_path(@socratic_seminar, topic)
              - if topic.link.present?
                %span.topic-link
                  = link_to truncate(topic.link, length: 50), topic.link, target: "_blank", rel: "noopener"
          - if topic.votable
            .vote-row
              .vote-count{"data-topics-target" => "voteCount"}= topic.votes || 0
              .vote-count-label votes
              .vote-buttons
                = button_to upvote_socratic_seminar_topic_path(@socratic_seminar, topic),
                  method: :post,
                  class: "vote-button",
                  disabled: (vote_state == 'up'),
                  form: { data: { topics_target: 'voteForm', turbo: 'false' } } do
                  %span.vote-arrow
                    %i.fas.fa-arrow-up
                = button_to downvote_socratic_seminar_topic_path(@socratic_seminar, topic),
                  method: :post,
                  class: "vote-button",
                  disabled: (vote_state == 'down'),
                  form: { data: { topics_target: 'voteForm', turbo: 'false' } } do
                  %span.vote-arrow
                    %i.fas.fa-arrow-down

          - if topic.payable
            .payment-row
              .sats-info
                .sats-label{"data-action" => "click->topics#toggleSatsLabel"} Sats
                .sats-received{"data-sats" => topic.sats_received}= topic.sats_received
              |
              = link_to (topic.votable ? "Vote with Lightning ⚡" : "Show appreciation with Lightning ⚡"), "https://www.lnurlpay.com/#{topic.lnurl}",
                class: "send-btc-link mobile-lightning-button",
                target: "_blank",
                rel: "noopener"

          - if topic.subtopics.any?
            .subtopics-container
              .subtopics-label Subtopics:
              .subtopics-list
                - topic.subtopics.each do |subtopic|
                  %span.subtopic-item
                    - if subtopic.link.present?
                      = link_to "→ #{subtopic.name}", subtopic.link, target: "_blank", rel: "noopener"
                    - else
                      = "→ #{subtopic.name}"
